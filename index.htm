<!DOCTYPE html> 
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>注音猜猜樂</title>
  <style>
    body { font-family:"Noto Sans TC",sans-serif; text-align:center; padding:30px; background:#f4f4f4; }
    h1 { font-size:2rem; margin-bottom:1rem; }
    #keyboard { display:flex; flex-wrap:wrap; justify-content:center; max-width:500px; margin:0 auto; gap:8px; }
    .key { font-size:1.5rem; padding:10px 14px; border:none; border-radius:8px; background:#fff; box-shadow:0 1px 4px rgba(0,0,0,.2); cursor:pointer; transition:.2s; }
    .key.correct { background:#4caf50; color:#fff; }
    .key.incorrect { background:#ccc; color:#fff; }
    .key:disabled { cursor:not-allowed; }
    #result { margin-top:30px; font-size:1.25rem; }
    #restartBtn,#shareBtn { margin-top:15px; padding:8px 16px; font-size:1rem; border:none; border-radius:6px; cursor:pointer; }
    #restartBtn { background:#2196f3; color:#fff; }
    #shareBtn { background:#4caf50; color:#fff; display:none; }
    #popup { display:none; position:fixed; bottom:30px; left:50%; transform:translateX(-50%); background:rgba(0,0,0,.8); color:#fff; padding:10px 20px; border-radius:5px; font-size:1rem; }
  </style>
</head>
<body>
  <h1>注音猜猜樂</h1>
  <div id="keyboard"></div>
  <div id="result"></div>
  <button id="restartBtn">重新開始</button>
  <button id="shareBtn">分享戰績</button>
  <div id="popup">已複製到剪貼簿！</div>

  <script>
  // 自動清掉網址參數（例如 fbclid）
  if (location.search.length > 0) {
    history.replaceState({}, document.title, location.origin + location.pathname);
  }

  // 全部包在 IIFE，避免從 console 直接存取到變數
  (() => {
    const bopomofo = ["ㄅ","ㄆ","ㄇ","ㄈ","ㄉ","ㄊ","ㄋ","ㄌ","ㄍ","ㄎ","ㄏ","ㄐ","ㄑ","ㄒ","ㄓ","ㄔ","ㄕ","ㄖ","ㄗ","ㄘ","ㄙ","ㄧ","ㄨ","ㄩ","ㄚ","ㄛ","ㄜ","ㄝ","ㄞ","ㄟ","ㄠ","ㄡ","ㄢ","ㄣ","ㄤ","ㄥ","ㄦ"];

    let _a = "";                 // ← 答案（不暴露到全域）
    let _g = 0;                  // 猜測次數
    const _m = bopomofo.length;  // 最大次數

    const kb = document.getElementById("keyboard");
    const rs = document.getElementById("result");
    const btnRestart = document.getElementById("restartBtn");
    const btnShare = document.getElementById("shareBtn");
    const tip = document.getElementById("popup");

    const pick = () => { _a = bopomofo[(Math.random() * bopomofo.length) | 0]; };

    const buildKeys = () => {
      kb.innerHTML = "";
      bopomofo.forEach(ch => {
        const b = document.createElement("button");
        b.textContent = ch;
        b.className = "key";
        b.addEventListener("click", () => guess(b, ch), { once:false });
        kb.appendChild(b);
      });
    };

    const disableAll = () => document.querySelectorAll(".key").forEach(b => b.disabled = true);

    const reset = () => {
      pick();
      buildKeys();
      rs.textContent = "";
      _g = 0;
      btnShare.style.display = "none";
    };

    const share = () => {
      const emoji = (_g > 0 ? ("⬛\n").repeat(Math.max(0, _g - 1)) : "") + "🟩";
      const fixedUrl = "https://bopomofo.langcheng.uk";
      const text = `注音猜猜樂\n${_g}/${_m}\n${emoji}\n${fixedUrl}`;

      if (navigator.clipboard && isSecureContext) {
        navigator.clipboard.writeText(text).then(() => {
          tip.style.display = "block"; setTimeout(()=> tip.style.display="none", 2000);
        }).catch(fallback);
      } else { fallback(); }

      function fallback(){
        const ta = document.createElement("textarea");
        ta.value = text; document.body.appendChild(ta);
        ta.select(); try { document.execCommand("copy"); tip.style.display = "block"; setTimeout(()=> tip.style.display="none", 2000); }
        catch(e){ alert("❌ 複製失敗，請手動複製。"); }
        document.body.removeChild(ta);
      }
    };

    const guess = (btn, ch) => {
      _g++;
      if (ch === _a) {
        btn.classList.add("correct");
        rs.textContent = `🎉 恭喜你第 ${_g} 次猜對！答案是 ${_a}`;
        disableAll();
        btnShare.style.display = "inline-block";
      } else {
        btn.classList.add("incorrect");
        btn.disabled = true;
        rs.textContent = `❌ ${ch} 錯誤，繼續猜！（已猜 ${_g} 次）`;
      }
    };

    
    btnRestart.addEventListener("click", reset);
    btnShare.addEventListener("click", share);

   
    reset();
//你竟然還看完了
   
    Object.defineProperty(window, "answer", { get(){ return "😉 別偷看啦"; } }); 
  })();
  </script> 
</body>
</html>



